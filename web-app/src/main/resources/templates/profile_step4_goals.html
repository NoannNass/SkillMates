<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <title>Créez votre profil - Objectifs d'apprentissage</title>
    <link rel="stylesheet" href="/css/style.css">
</head>

<body>
    <div class="progress-bar">
        <div class="progress" style="width: 80%"></div>
    </div>
    <div class="container">
        <h2>Créez votre profil</h2>
        <p style="text-align:center; margin-bottom: 24px;">Personnalisez votre profil pour trouver les meilleurs
            partenaires d'apprentissage</p>
        <form id="goalsForm" th:action="@{/profile-completion/step4}" method="post">
            <div class="form-step">
                <h3>Objectifs d'apprentissage</h3>
                <p style="margin-bottom: 18px;">Définissez vos objectifs pour trouver des partenaires avec des ambitions
                    similaires</p>
                <div class="form-group" style="display:flex; gap:8px;">
                    <input type="text" id="objectiveInput" placeholder="Objectif d'apprentissage" style="flex:1;" />
                    <button type="button" class="btn btn-secondary" id="addObjectiveBtn">+ Ajouter un objectif</button>
                </div>
                <div id="objectivesList"></div>
                <div class="tips">
                    <h4 style="margin:0 0 8px 0;">Conseils pour définir de bons objectifs</h4>
                    <ul style="margin:0; padding-left:18px;">
                        <li>Soyez spécifique (ex: "Apprendre React" plutôt que "Apprendre le développement web")</li>
                        <li>Définissez des objectifs mesurables</li>
                        <li>Fixez-vous des délais réalistes</li>
                    </ul>
                </div>
                <div class="form-navigation">
                    <a href="/profile-completion/step3" class="btn btn-secondary">&larr; Précédent</a>
                    <button type="submit" class="btn btn-primary">Finaliser mon profil &rarr;</button>
                </div>
            </div>
        </form>
    </div>
    <script>
        const addBtn = document.getElementById('addObjectiveBtn');
        const input = document.getElementById('objectiveInput');
        const list = document.getElementById('objectivesList');
        const form = document.getElementById('goalsForm');

        function createObjective(title) {
            const div = document.createElement('div');
            div.className = 'tag-suggestion';
            const hidden = document.createElement('input');
            hidden.type = 'hidden';
            hidden.name = 'learningObjectives';
            hidden.value = title;
            const label = document.createElement('span');
            label.textContent = title;
            const removeBtn = document.createElement('span');
            removeBtn.textContent = '✕';
            removeBtn.style.marginLeft = '8px';
            removeBtn.style.cursor = 'pointer';
            removeBtn.onclick = () => div.remove();
            div.appendChild(hidden);
            div.appendChild(label);
            div.appendChild(removeBtn);
            return div;
        }

        addBtn.onclick = function (e) {
            e.preventDefault();
            const value = input.value.trim();
            if (value.length > 0 && list.childElementCount < 3) {
                list.appendChild(createObjective(value));
                input.value = '';
            }
            if (list.childElementCount >= 3) {
                addBtn.disabled = true;
                input.disabled = true;
            }
        };

        list.addEventListener('DOMNodeRemoved', function () {
            if (list.childElementCount < 3) {
                addBtn.disabled = false;
                input.disabled = false;
            }
        });

        form.onsubmit = function (e) {
            if (list.childElementCount < 1) {
                alert('Veuillez ajouter au moins un objectif.');
                e.preventDefault();
            }
        };
    </script>
</body>

</html>